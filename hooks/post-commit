#!/bin/bash
#
# Post-commit hook for NexusComm
# Runs after each commit to verify architecture integrity

echo "ğŸ” Verifying NexusComm architecture after commit..."

# Check if the commit includes architecture-related files
if git diff --name-only HEAD^ HEAD | grep -E "(domain|application|infrastructure|ARCHITECTURE)" > /dev/null; then
    echo "âœ… Architecture-related changes detected, running verification..."
    
    # Verify dependency injection configuration exists
    if [ -f "backend/src/infrastructure/config/DependencyInjectionConfig.ts" ]; then
        echo "âœ… Dependency injection configuration found"
    else
        echo "âŒ Dependency injection configuration missing"
        exit 1
    fi
    
    # Verify key architectural components exist
    if [ -f "backend/src/domain/entities/Message.ts" ] && 
       [ -f "backend/src/application/use_cases/CreateMessageUseCase.ts" ] &&
       [ -f "backend/src/infrastructure/repositories/TypeORMMessageRepositoryAdapter.ts" ]; then
        echo "âœ… Core architectural components verified"
    else
        echo "âŒ Core architectural components missing"
        exit 1
    fi
    
    # Verify architecture documentation exists
    if [ -f "ARCHITECTURE.md" ]; then
        echo "âœ… Architecture documentation found"
    else
        echo "âš ï¸  Architecture documentation missing"
    fi
    
    echo "âœ… NexusComm architecture verification completed successfully!"
    echo "ğŸš€ Clean/Hexagonal architecture with DDD principles maintained"
else
    echo "â„¹ï¸  No architecture-related changes in this commit, skipping detailed verification"
fi

echo "ğŸ“¦ Commit verification complete!"